---
import type { InferGetStaticParamsType, InferGetStaticPropsType } from "astro";
import Layout from "../layouts/Layout.astro";
import getPosts from "../lib/getPosts";

export async function getStaticPaths() {
  const posts = await getPosts();

  return posts.map((p) => ({
    params: {
      post: p.slug,
    },
    props: {
      content: p.content,
      title: p.title,
      date: p.wp?.Date,
      author: p.wp?.["Author Username"],
    },
  }));
}

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { post } = Astro.params as Params;
const { content, title, date, author } = Astro.props as Props;
---

<Layout title={title}>
  <h1>{title}</h1>
  <p>{date}</p>
  <p>By {author}</p>
  <a href=`/${post}`>Permalink</a>
  <div set:html={content} />
</Layout>
