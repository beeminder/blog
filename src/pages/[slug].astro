---
import Layout from "../layouts/Layout.astro";
import getPosts from "../lib/getPosts";
import parseMarkdown from "../lib/parseMarkdown";

export async function getStaticPaths() {
  const posts = getPosts();
  const values = [];

  for (const p of posts) {
    console.log("start", p.exportUrl);

    const response = await fetch(p.exportUrl);
    const markdown = await response.text();
    const slug = p.wp?.Slug;

    if (!slug) {
      throw new Error(`No slug for ${p.exportUrl}`);
    }

    values.push({
      params: {
        slug,
      },
      props: parseMarkdown(markdown),
    });

    console.log("end", p.exportUrl);
  }

  return values;
}

const { slug } = Astro.params;
const { content, title } = Astro.props;
---

<Layout title={title}>
  <h1>{title}</h1>
  <a href=`/${slug}`>Permalink</a>
  <div set:html={content} />
</Layout>
