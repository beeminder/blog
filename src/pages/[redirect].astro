---
import type { InferGetStaticPropsType } from "astro";
import getPosts from "../lib/getPosts";
import makeRedirects from "../lib/makeRedirects";
import Layout from "../layouts/Layout.astro";

export async function getStaticPaths() {
  const posts = await getPosts();
  const slugs = posts.map((post) => post.slug);
  const redirects = makeRedirects(slugs);

  return redirects.map((r) => ({
    params: {
      redirect: r.from,
    },
    props: r,
  }));
}

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { to } = Astro.props;
---

<Layout title="Redirecting..." redirect={to}>
  If you are not redirected momentarily, <a id="redirect-link" href={to}
    >click here</a
  >.
</Layout>

<script>
  const link = document.getElementById("redirect-link");
  if (link instanceof HTMLAnchorElement) {
    window.location.href = link.href;
  }
</script>
